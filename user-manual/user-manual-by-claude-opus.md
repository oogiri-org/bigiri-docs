<!--@include: ./index.md-->

# bǃgǃrǃ ユーザーマニュアル

bǃgǃrǃ（ビギリ）は、オンラインで大喜利を楽しむためのウェブアプリケーションです。参加者がお題に対してボケ（面白い回答）を投稿し、投票によって順位を決める、柔軟な設定が可能な大喜利プラットフォームです。

---

## 1. はじめに

bǃgǃrǃ は「For Beautiful Oogiri Life」をサブタイトルに掲げる大喜利ウェブアプリケーションです。部屋を作成し、お題を出し、回答を募り、投票で順位を決めるという一連の大喜利の流れをオンラインで実現します。

### 基本的な流れ

1. サインインする
2. 部屋を作成する、または既存の部屋に入室する
3. お題が出題される
4. 参加者が回答を投稿する
5. 参加者が回答に投票する
6. 結果が表示される
7. 次のお題へ進む

### 対応ブラウザ

最新バージョンの主要ブラウザに対応しています。言語仕様としてECMAScript 2022を使用しています。

---

## 2. サインイン

bǃgǃrǃ を利用するにはサインインが必要です。以下のサインイン方法があります。

### 匿名サインイン

名前を入力してサインインします。名前の初期値は「お客さん」です。

### Blueskyサインイン

Blueskyアカウントを使ったOAuthサインインが利用できます。サインイン画面のBlueskyでサインインボタンから行います。

### Twitterサインイン（Sign in with Twitter）

Twitterアカウントでサインインできます。Twitterサインインしたユーザーは入室者一覧の名前にTwitterへのリンクが設定され、画面上部右端にTwitterのプロフィール画像が表示されます。

### 名前の変更

サインアウトせずに名前を変更することができます。

### 名前のハッシュ値

名前に `#文字列` を含めると、その部分が暗号学的ハッシュ関数値（8文字）に変換されて表示されます。これにより、同じ文字列を知っている人だけが同一人物であることを確認できます。

**例:**

| 入力 | 表示 |
|------|------|
| びぎりちゃん | びぎりちゃん |
| びぎりちゃん#abc | びぎりちゃん#DnbJh2JQ |

名前にハッシュ値を設定している場合、Twitterサインインを行っていても入室者一覧でTwitterへのリンクは表示されません。

---

## 3. トップ画面

トップ画面では以下の情報と操作が利用できます。

### 部屋一覧

現在作成されている部屋の一覧が表示されます。各部屋には以下の情報が含まれます。

- 部屋名
- 説明
- 入室者名
- アイコン画像
- 出題日時
- 通知の有無（過去のバージョン）
- Blueskyリンク

部屋一覧では自分の名前が判別できるよう表示されます。

### 表示順の変更

部屋の表示順をドロップダウンリストから変更できます。

- **作成順** - 部屋の作成日時の降順
- **更新順** - 部屋の更新日時の降順

### 更新情報

トップ画面に更新情報が表示されます。更新情報を見るボタンを押すと、更新情報の履歴をダイアログウィンドウで確認できます。

### クリエイティブ・コモンズ・ライセンス

トップ画面にクリエイティブ・コモンズ・ライセンスが掲示されています。

---

## 4. 部屋を作成する

部屋は大喜利を行うための空間です。部屋を作成するには、トップ画面から「部屋を作成する」操作を行います。

### 基本設定

- **部屋名** - 部屋の名前を設定します
- **説明** - 部屋の説明を記入します。説明内に書かれたURLは自動でリンクになります
- **アイコン画像** - 部屋の右下に常に表示される画像を設定できます。容量制限があります

### 出題に関する設定

| 設定項目 | 説明 |
|----------|------|
| 出題者制限 | 出題できる人を制限します。「無し」「有り」「有り（Sign in with Twitter）」から選択できます |
| 出題優先時間 | 出題の優先権を設定します。「無し」「有り（投票者内1位）」「有り（部屋作成者）」から選択できます。有り（投票者内1位）の場合は前回の投票者の中で1位の人に出題の優先権が与えられます。有り（部屋作成者）の場合は部屋作成者のみが出題できます。部屋作成者は出題優先を途中で締め切ることができます |
| 出題画像制限 | お題に画像を使用できるかを設定します |
| 出題コメント制限 | 出題へのコメントを制限します。制限無しか部屋作成者のみに制限かの二択です |

### 回答に関する設定

| 設定項目 | 説明 |
|----------|------|
| 回答者制限 | 回答できる人を制限します |
| 回答表示 | 回答の表示方法を「即時」（投稿されるとすぐ表示）または「一斉」（締め切り後にまとめて表示）から選びます |
| 回答時間制限 | 回答フェーズの制限時間を設定します |
| 回答シャッフル時間 | 設定した時間内の回答は、投票フェーズで入室者毎にランダムな順番で表示されます。空の場合は全ての回答がシャッフルの対象になります。結果フェーズでの順番には影響しません |
| 回答者名表示 | 回答者の名前を表示するか匿名にするかを設定します（自分の回答の回答者名は常に表示されます） |
| 回答数制限 | 1人あたりの回答数を制限します |
| 回答描画 | 回答に手描きの線画を追加できるかを設定します |
| 回答コメント制限 | 回答へのコメントを制限します。制限無しか部屋作成者のみに制限かの二択です |

### 投票に関する設定

| 設定項目 | 説明 |
|----------|------|
| 投票者制限 | 投票できる人を制限します |
| 投票表示 | 投票の表示方法を「即時」または「一斉」から選びます |
| 投票時間制限 | 投票フェーズの制限時間を設定します。回答数に比例して投票時間が追加される設定も可能です |
| 投票者名表示 | 投票者の名前を表示するか匿名にするかを設定します（自分の投票の投票者名は常に表示されます） |
| 投票数制限（出題毎） | 1つのお題あたりの投票数を制限します。「有り（超過可）」に設定すると、制限に達しても投票画面での投票数は超過できます |
| 投票数制限（1題毎） | 1つの回答あたりの投票数を制限します |
| 投票グループ | グループに基づいた投票の制限を設定します（詳細は「グループ機能」の章を参照） |

### カラースキーム

部屋のデフォルトのカラースキームを「ライト」または「ダーク」から選択して設定できます。

### 履歴機能

部屋名の横の履歴ボタンを押すと、同じブラウザーで過去に作成した部屋の一覧が表示されます。読み込むボタンを押すとその設定を読み込み、削除するボタンを押すとその設定を削除できます。同一の部屋名で部屋を作成した場合、履歴には最新の設定のみが残されます。

### 部屋作成の制限

Twitterサインインしていない場合、未出題のまま複数の部屋を作成することはできません（1つまで）。Twitterサインインしている場合は、未出題のまま複数の部屋を作成できます。

---

## 5. 部屋画面

部屋画面は大喜利の進行が行われるメイン画面です。

### メニューバー

部屋画面の上部にはメニューバーがあり、以下の操作が行えます。

- **タブ切り替え** - メニューバーのタブにより表示を変更できます。タブを切り替えると非共通部分までスクロールします
- **カラースキームボタン** - 部屋のカラースキームを「オート」「ライト」「ダーク」から選択できます。「オート」ではブラウザーやOSの設定に従います。なおこの選択は保存されません
- **入室者を見るボタン** - 入室者一覧を表示します
- **グループを見るボタン** - グループ画面を表示します
- **ログ（CSV）ボタン** - CSVログのダウンロード画面を表示します
- **過去の結果ボタン** - 過去の出題の結果を参照できます
- **サインオーバー** - 別のブラウザーにサインイン状態を引き継ぐ機能です

### 部屋コメント

部屋作成者は部屋のトップページ上部にコメントを表示できます。部屋コメントの削除は最新1つが削除されます。

### ナビゲーションバー

画面上部のナビゲーションバーには自分の名前が表示されます。グループに所属している場合は、名前の前にグループ名が表示されます。

### 部屋の存続時間

部屋は最終更新日時から11.5日間存続します。

---

## 6. ゲームの流れ（フェーズ）

bǃgǃrǃ の大喜利は4つのフェーズで進行します。フェーズの進行は部屋作成者が管理します。

### 出題フェーズ

出題者がお題を投稿するフェーズです。出題優先時間が設定されている場合、優先される出題者の「出題する」ボタンが明滅します。

### 回答フェーズ

参加者がお題に対する回答を投稿するフェーズです。回答時間制限が設定されている場合、タイマーが表示されます。

### 投票フェーズ

参加者が回答に投票するフェーズです。投票表示が一斉の場合、投票フェーズになってから投票できます。投票時間制限が設定されている場合、タイマーが表示されます。

### 結果フェーズ

投票結果が表示されるフェーズです。各回答の得票数と順位が確認できます。

---

## 7. 出題

### テキストによる出題

お題をテキストで入力します。入力文字数の制限は1500文字です。150文字を越えた出題には越えた位置にボタンが表示され、押すと残りの部分が表示されます。

### 画像によるる出題

お題に画像を添付することができます（部屋設定で許可されている場合）。出題画像の背景色は白です。画像お題の本文のデフォルト値は画像のファイル名になります。

### 出典の入力

出題に著作物を用いる場合は、出典を入力する欄に適切な出典を記入してください。

### 出題の競合

複数の人が同時に出題しようとした場合の対処機能があります。

---

## 8. 回答

### テキストによる回答

お題に対する回答をテキストで入力します。入力文字数の制限は1500文字です。150文字を越えた回答、および10行を越えた回答には、越えた位置にボタンが表示され、押すと残りの部分が表示されます。

### 回答描画

部屋設定で回答描画が許可されている場合、回答に手描きの線画を追加して表示することができます。

### 回答の変更

投稿した回答を変更することができます。回答時刻も更新されます。

### 回答の削除

投稿した回答を削除することができます。直前に削除された回答がある場合、その内容がデフォルトとして回答欄に設定されます。

### 回答数の表示

回答フェーズ中、リアルタイムで回答数が表示されます。

### 送信方法

出題および回答の文字入力欄でCtrl+改行キーを打つことで入力内容を送信できます。

---

## 9. 投票

### 投票の方法

回答に対して投票数を設定して投票します。投票画面の投票数ボタンでは以下の操作が可能です。

- **スペースキー** - 増票
- **デリートキー** - 減票
- **改行キー** - 入力内容を送信
- **マウスドラッグ** - 上方向にドラッグすると増票、下方向にドラッグすると減票

投票画面を開くと投票数ボタンに初期フォーカスが設定されます。

### 0票の投票

0票の投票も可能です。

### 投票の変更

投票数を減らす場合、投票を一旦削除しなくても投票を変更するボタンから減らすことができます。

### 投票の削除

投票を削除することができます。

### 投票数制限（出題毎）の超過可設定

部屋設定で投票数制限（出題毎）が「有り（超過可）」になっている場合、制限に達すると投票するボタンは投票一覧ボタンに変わりますが、投票画面での投票数は制限を超過できます。

### 投票を見る

投票フェーズで投票を見るボタンが回答一覧の上部にも表示されます。投票後は投票を見る画面で以下のスクロール動作があります。

- 投票数制限（1題毎）が「有り（超過可）」の場合、末尾にスクロールします
- 0票を投票した後の場合、末尾にスクロールします
- 最後に投票した回答にスクロールします

### 回答毎の投票の表示順

回答毎の投票は投票数降順で表示されます。投票数が同じ投票の表示順は投票順です。

---

## 10. 結果

### 順位の決定方法

結果フェーズでは得票数に基づいて順位が決定されます。

- 得票数が同じ回答は、回答者の投票数が多い方を上位とします
- 回答者の投票数も同じ場合は、回答の早い方を上位とします

### ユニコーンとアイスクリーム

結果フェーズでは、回答の補正得票数の標準化変量に基づいて特別な表示が行われます。

- **標準化変量が1以上** - 順位に下線が表示されます
- **標準化変量が2以上** - 順位とともにユニコーンが表示されます。さらに1上がるごとにユニコーンが1つ増えます
- **標準化変量が-1以下** - 順位に上線が表示されます
- **標準化変量が-2以下** - アイスクリームが表示されます。さらに1下がるごとにアイスクリームが1つ増えます

### 過去の結果

過去の出題の結果を参照することができます。表示範囲は34.5日以内の出題です。

---

## 11. コメント機能

bǃgǃrǃ には3種類のコメント機能があります。

### 部屋コメント

部屋作成者がいつでも投稿・表示および削除できるコメントです。部屋画面の上部に表示されます。削除は最新の1つが対象です。

### 出題コメント

出題に対するコメントです。結果フェーズにて投稿・表示できます（部屋設定で制限可能）。削除はできません。

### 回答コメント

回答に対するコメントです。結果フェーズにて投稿・表示できます（部屋設定で制限可能）。削除はできません。回答も投票もしていない入室者でもコメントできます。

### クイックコメント（リアクション）

回答および出題に対して絵文字によるクイックコメント（リアクション）を投稿できます。

- **回答へのリアクション** - 結果フェーズ画面で回答コメントボタンの横にあるスマイルボタンを押し、ドロップダウンリストから絵文字を選択します
- **出題へのリアクション** - 出題コメントにリアクション機能が利用できます

空文字列のコメントも許されます。

---

## 12. グループ機能

入室者をまとめる「グループ」機能を使って、参加者をチーム分けすることができます。

### グループの作成と削除

部屋作成者は「グループを選ぶ」画面からグループの作成や削除を行うことができます。グループの名前は重複でき、空文字列も許されます。グループは作成された部屋内でのみ有効です。グループには説明欄を設定できます。

### グループの動作

- グループが追加されると、グループに入っていない入室者にはグループを選ぶ画面が表示されます
- グループが追加された以降に入室した入室者には最初にグループを選ぶ画面が表示されます
- 選んだグループが削除された入室者にもグループを選ぶ画面が表示されます
- グループを選ぶ画面から自分のグループを表示・選択し別のグループに入ることができます

### グループ名の表示

- ナビゲーションバーにおいて自分の名前の前にグループ名が表示されます
- メイン画面および過去の結果画面において回答者名の前にグループ名が表示されます
- 入室者を見る画面において入室者名の前にグループ名が表示されます

### 投票グループ

部屋設定で「投票グループ」を設定すると、投票フェーズで表示される回答がグループに基づいて制限されます。

| 設定値 | 動作 |
|--------|------|
| 無し | 全ての回答が表示されます |
| グループ内に投票 | 自分と同じグループの回答だけが表示されます |
| 有り（次グループに投票） | 自分のグループの直後に作成されたグループの回答だけが表示されます。自分のグループが最後の場合は最初のグループの回答が表示されます。グループを選んでいない場合はグループを選んでいない回答だけが表示されます |

投票グループを設定した場合、投票時間制限の回答毎の時間計算には全体の回答数ではなく、表示された回答数が最も多いグループの回答数が採用されます。グループを作成していなければ、設定が無い場合と同様の動作になります。

### グループフィルター

結果フェーズおよび過去の結果画面でグループ名を押すと、そのグループの回答だけを表示するフィルターが適用されます。

### グループの履歴機能

グループ名の横の履歴ボタンを押すと、同じブラウザーで作成したグループの一覧が表示され、設定の読み込みや削除ができます。

---

## 13. 入室者の管理

### 入室者一覧

部屋画面の「入室者を見る」ボタンから入室者一覧を表示できます。入室者一覧には以下の情報が表示されます。

- 入室者名
- グループ名
- トークン（8文字の英数字）
- ユニコーン累計数
- プロフィール画像（Twitterサインインの場合）
- 新規登録者マーク（24時間以内に登録した入室者）
- 入室者数

退室した出題者・回答者・投票者も入室者一覧に含まれます。受刑者は取り消し線つきで表示されます。

### 入室者の表示順

入室者一覧の表示順をドロップダウンリストから変更できます。

- **先入順 / 後入順** - 入室時刻順
- **多順 / 少順** - ユニコーン獲得数順
- **昇名順 / 降名順** - 名前のUnicode値順
- **昇Di順 / 降Di順** - ディスクリミネーターのUnicode値順

### 入室者の権限管理

部屋作成者は入室者一覧から以下の操作ができます。

- 入室者を**出題者**に追加・削除
- 入室者を**回答者**に追加・削除
- 入室者を**投票者**に追加・削除

入室者一覧で個別に設定を行っている場合、部屋作成画面で行った制限設定はその項目について無視されます。

### 受刑者の管理

部屋作成者は入室者を**受刑者**へ追加・削除できます。

- 受刑者に追加された入室者は強制退室となります
- 受刑者に追加した場合、同一の発信元から出題・回答・投票・コメントする入室者も自動的に追加されます
- 不正なアクセスによる出題・回答・投票・コメントを行おうとした入室者は自動的に受刑者に追加されます

### 部屋内での名前変更

部屋内で名前の変更ができます。変更された名前はその部屋でのみ有効で、入室者一覧でのソーシャルサービスへのリンクは表示されなくなります。

### トークンの確認

出題者・回答者・投票者の名前をクリックすると、入室者のトークン（入室者一覧の右側に表示されている文字列）が表示されます。新規登録者マークのクリックでは登録日時が表示されます。

### 操作ボタン群の開閉

幅の狭いブラウザーで入室者を見る画面を表示した場合、操作ボタン群を開閉できます。

---

## 14. 表示のカスタマイズ

### 回答の表示順

回答の表示順をドロップダウンリストから変更できます。全てのフェーズで使用可能です。

| 表示順 | 説明 |
|--------|------|
| 設定順 | 部屋設定によるデフォルトの表示順 |
| 先着順 | 早く回答した順 |
| 後着順 | 遅く回答した順 |
| 上位順 | 得票数が多い順 |
| 下位順 | 得票数が少ない順 |
| コ多順 | コメント数が多い順（結果フェーズおよび過去の結果画面） |
| コ少順 | コメント数が少ない順（結果フェーズおよび過去の結果画面） |

### フィルター機能

回答一覧の先頭にあるフィルターボタンで、表示する回答を絞り込むことができます。下方にスクロールしてもフィルターボタンは表示され続けます。

| フィルター | 説明 | 使用可能フェーズ |
|------------|------|-----------------|
| 自回答フィルター | 自分の回答のみ表示 | 回答・投票・結果フェーズ、過去の結果 |
| 自投票フィルター | 自分が投票した回答のみ表示 | 投票・結果フェーズ、過去の結果 |
| 自コメントフィルター | 自分がコメントした回答のみ表示 | 結果フェーズ、過去の結果 |

フィルターにはそれぞれの数（自回答数、自投票数）が併記されます。自回答・自投票フィルターとフィーチャー機能は併用できます。

### フィーチャー機能

結果フェーズおよび過去の結果画面で、特定の回答を注目表示する機能です。回答の目のアイコンを押すとその回答のみの表示になり、もう一度押すと元の表示に戻ります。

### カラースキーム

部屋画面のメニューバーのカラースキームボタンから、表示モードを切り替えられます。

- **オート** - ブラウザーやOSの設定に従います
- **ライト** - 明るい表示
- **ダーク** - 暗い表示

---

## 15. ログ（CSV）

部屋の出題・回答・投票のデータをCSVファイルとしてダウンロードできます。

### ダウンロード方法

ログ（CSV）画面でURLを選択するとダウンロードが始まります。ダウンロードの際には入室している必要があります。サーバーが処理中の場合はその旨が表示されます。

### CSVファイルの種類

- **通常のCSVファイル** - 出題者・回答者・投票者の情報を含みます
- **ディスクリミネーター付きCSVファイル** - 名前にディスクリミネーター（入室者を見る画面で表示される8つの文字）を改行区切りで付加したCSVファイルです

### CSVの内容

CSVファイルの9番目のカラムにグループ名が出力されます。回答者名カラムにはグループが設定されている場合、回答者名の前にグループ名と改行が追加されます。

---

## 16. サインオーバー

サインオーバーは、現在のサインイン状態を別のブラウザーに引き継ぐ機能です。

### 使い方

1. トップ画面または部屋画面のメニューからサインオーバーを選びます
2. 表示されるURLまたはそのQRコードを確認します
3. URLをコピーするボタンでURLをコピーできます
4. 引き継ぎ先のブラウザーから1時間以内にそのURLを開きます
5. サインイン状態が引き継がれます

---

## 17. その他の機能

### Atomフィード

bǃgǃrǃ はAtomフィードを提供しています。フィードには部屋作成者名が含まれます。

### ソーシャル連携

- **Blueskyリンク** - 部屋一覧と部屋画面にBlueskyリンクが表示されます
- **Twitterリンク** - 部屋名をハッシュタグとして検索・ツイートできるリンクが表示されます

### ユニコーン累計

入室者一覧にはその部屋で与えられたユニコーンの累計が表示されます。ユニコーンの算定は回答者の投票数で補正されます。

### 入力文字数超過

入力文字数を超過した場合はエラーメッセージが表示されます。

---

## 18. キーボード操作

### 投票画面

| キー | 動作 |
|------|------|
| スペースキー | 投票数を増やす（投票数ボタンにフォーカス時） |
| デリートキー | 投票数を減らす（投票数ボタンにフォーカス時） |
| 改行キー | 入力内容を送信（投票数ボタンにフォーカス時） |

### テキスト入力

| キー | 動作 |
|------|------|
| Ctrl + 改行 | 出題・回答の入力内容を送信 |
